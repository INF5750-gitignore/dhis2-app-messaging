<div class="container" ng-controller="ShowAllMessages" id="rootElement">
	<div class="header">
		<div ng-show="online"  id="messageListTitle">Messages <div class="badge totalUnread">{{(messages|filter:unreadMessages).length}}</div></div>
		<div ng-hide="online"  id="messageListTitle">Messages (offline) <div class="badge">{{(messages|filter:unreadMessages).length}}</div></div>

	</div>

	<div class="row messageControlPanel">

		<span class="btn-group col-xs-12 col-md-1">
			<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Options</button>
			<ul class="dropdown-menu" role="menu">
				<li><a href="" onclick="markAsRead()">Mark Read</a></li>
				<li><a href="" onclick="markAsUnread()">Mark unread</a></li>
				<li><a href="">Follow-Up</a></li>
				<li><a href="">Stop Following</a></li>
				<li class="divider"></li>
				<li><a href="">Delete</a></li>
			</ul>
		</span>

		<span class="col-xs-12 col-sm-3">
			<select class="form-control messageFilterSelect" ng-model="messageFilter" ng-options="filter.display for filter in filters"></select>
		</span>

		<span class="col-xs-12 col-sm-3">
			<input class="col-xs-12 form-control" type="text" id="searchBox" ng-model="searchText" placeholder="Search"></input>
		</span>

	</div>
	<!-- <div ng-repeat="page in dhis.pages"> -->
	<div ng-repeat="message in messages | filter: searchFilter | orderBy:'created':true | filterMessageDisplay:messageFilter">

		<div class="row list-group-item message-list" ng-class="{unread: message.read == false}">

			<span class="col-xs-1 col-lg-1 messageGlyph">
				<input  type="checkbox" value="{{ message.id }}"></input>
				<span class="glyphicon star" ng-class="{'glyphicon-star-empty': message.followUp == false, 'glyphicon-star': message.followUp}"></span>

			</span>

			<span>
				<a class="fillthespan" href="#msg/{{ message.id }}">
					<span class="col-xs-7 col-lg-4 ellipsize">

						<span ng-show="{{ getName(message).length }}" >{{ getName(message) }}</span>
						<span ng-hide="{{ getName(message).length }}" >(System message)</span>

						<span>({{message.messageCount}})</span>
					</span>

					<span class="col-xs-3 col-lg-2 col-lg-push-4 dateDisplay ellipsize">{{ message.created | date : 'dd MMM yyyy' }}</span>
					<span class="col-xs-12 col-lg-5 col-lg-pull-4 ellipsize">{{ message.displayName }}</span>
				</a>
			</div>

			<!-- </div> -->
		</div>

		<div ng-show="dhis.busy" class="loader">
			<span class="glyphicon glyphicon-refresh btn-lg spin"></span> Loading...
		</div>
		<div ng-hide="dhis.busy" class="loader">
			<span class="btn-lg"></span>
		</div>
	</div>

</div>


<script type="text/javascript">


function markAsRead()
{

	var checkedValues = $('input:checkbox:checked').map(function() {
		return this.value;
	}).get();

	for (i = 0; i < checkedValues.length; i++) { 
		angular.element('#rootElement').scope().markReadID(checkedValues[i]);
	}
}

function markAsUnread()
{

	var checkedValues = $('input:checkbox:checked').map(function() {
		return this.value;
	}).get();

	for (i = 0; i < checkedValues.length; i++) { 
		angular.element('#rootElement').scope().markUnreadID(checkedValues[i]);
	}
}

</script>

<!-- <span ng-show="{{ message.lastSenderFirstname.length }}" class="col-xs-6 col-md-3 col-lg-2 ellipsize">{{ message.lastSenderFirstname }} {{ message.lastSenderSurname }}</span>
<span ng-hide="{{ message.lastSenderFirstname.length }}" class="col-xs-6 col-md-3 col-lg-2 ellipsize">(System message)</span>

<span class="col-xs-3 col-md-2 col-lg-1 col-md-push-4 col-lg-push-6 badge">{{ message.created | date : 'dd MMM yyyy' }}</span>


<span class="col-xs-12 col-md-4 col-lg-3 col-md-pull-4 col-lg-pull-2 ellipsize">{{ message.displayName }}</span>
<span class="col-xs-12 col-md-9 col-lg-4 col-md-offset-3 col-lg-offset-0 col-lg-pull-2 ellipsize">{{ message.messages[0].name }}</span>
-->
